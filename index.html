<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Global Azure Day 2017 - Intructions</title>

	<meta charset="utf-8">
	<meta name="description" content="A guide for Global Azure Dya 2107, using a quick start guide template by TJ VanToll">
	<meta name="author" content="Mike Branstein">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="css/style.css" rel="stylesheet">
</head>
<body>

<div id="container">
	<div id="header">
		<a href="#" class="menu header-btn" id="toggle-toc"></a>
		<h1>Global Azure Day 2017 - Intructions</h1>
		<a href="https://github.com/mikebranstein/GlobalAzureDay2017-instructions" class="github header-btn"></a>
	</div>

	<div id="content-container">
		<div id="toc">
			<div class="toc-heading">Table of Contents</div>
			<div id="toc-padding"></div>
		</div>
		<div id="book">
			<div class="chapter">
				<h2 id="introduction">Introduction</h2>
<p>Welcome to Global Azure Bootcamp! All around the world user groups and communities want to learn about Azure and Cloud Computing! On April 22, 2017, all communities will come together once again in the fifth great Global Azure Bootcamp event! Each user group will organize their own one day deep dive class on Azure the way they see fit and how it works for their members. The result is that thousands of people get to learn about Azure and join together online under the social hashtag #GlobalAzure! Join hundreds of other organizers to help out and be part of the experience! </p>
<h3 id="about-the-2017-louisville-global-azure-bootcamp">About the 2017 Louisville Global Azure Bootcamp</h3>
<p>The 2017 Louisville Global Azure Bootcamp is a free one-day global training event on Azure, from the community to the community. See our event <a href="http://louisville.azurebootcamp.net/">home page</a> for more details. </p>
<p>This years format will be a blend of brief presentations, followed by hands-on and guided labs. </p>
<p>Our speakers include:</p>
<ul>
<li><a href="https://twitter.com/chadgreen">Chad Green</a><ul>
<li><a href="http://phrehab.com/">ProgressiveHealth</a></li>
<li><a href="http://www.codepalousa.com/">CodePaLOUsa</a></li>
<li><a href="http://www.chadgreen.com/">ChadGreen.com</a></li>
</ul>
</li>
<li><a href="https://twitter.com/mikebranstein">Mike Branstein</a><ul>
<li><a href="http://kizan.com">KiZAN Technologies</a></li>
<li><a href="https://brosteins.com">Brosteins</a></li>
</ul>
</li>
</ul>
<h3 id="getting-started">Getting Started</h3>
<p>To get started you&#39;ll need the following pre-requisites. Please take a few moments to ensure everything is installed and configured.</p>
<ul>
<li>Microsoft Windows PC</li>
<li><a href="https://www.visualstudio.com">Visual Studio</a> 2015 or later</li>
<li><a href="https://azure.microsoft.com">Azure Subscription</a> (trial is ok, and we&#39;ll sign you up in our first session)</li>
<li><a href="https://azure.microsoft.com/en-us/downloads/">Azure SDK for .NET</a> installed (be sure to get the right one for your version of Visual Studio)</li>
<li><a href="http://storageexplorer.com/">Storage Explorer</a> installed</li>
<li><a href="https://go.microsoft.com/fwlink/?LinkId=717179&amp;clcid=0x409">Storage Emulator</a> installed</li>
<li>The <a href="https://github.com/mikebranstein/GlobalAzureDay2017/tree/start">starter project</a> on Github</li>
</ul>
<h3 id="what-you-re-building">What you&#39;re building</h3>
<p>Azure is big. Really big. Too big to talk about all things Azure in a single day. </p>
<p>We&#39;ve assembled an exciting workshop to introduce you to several Azure services that cloud developers should know about:</p>
<ul>
<li><a href="https://azure.microsoft.com/en-us/services/app-service/web/">web app</a></li>
<li><a href="https://azure.microsoft.com/en-us/services/storage/blobs/">BLOB storage</a></li>
<li><a href="https://azure.microsoft.com/en-us/services/storage/tables/">table storage</a></li>
<li><a href="https://azure.microsoft.com/en-us/services/functions/">functions</a></li>
<li><a href="https://www.microsoft.com/cognitive-services">Cognitive Services</a> API for <a href="https://www.microsoft.com/cognitive-services/en-us/computer-vision-api">computer vision</a></li>
<li><a href="https://www.asp.net/signalr">SignalR</a> (yeah it&#39;s not a Azure service, but it is pretty cool)</li>
</ul>
<p>In this workshop you&#39;ll learn how to use these Azure services to build a cloud-hosted single sign-on app that can manage your user profile. When you&#39;re finished, you will have built and app that allows you to upload profile pictures that pass through an AI content filter to ensure they&#39;re work appropriate. </p>
<p>Key concepts and take aways:</p>
<ul>
<li>Navigating the Azure portal</li>
<li>Using Azure Resource Groups to manage multiple Azure services</li>
<li>Deploying a web app to Azure web app service</li>
<li>Using Windows Identity as a login provider</li>
<li>Creating Azure storage accounts</li>
<li>Azure Table storage </li>
<li>Storing images in Azure BLOB storage</li>
<li>Using Azure functions to coordinate asynchronous processes</li>
<li>Consuming the Microsoft Cognitive Services API to analyze images</li>
<li>Using SignalR to asynchronously update web UIs</li>
</ul>
<h3 id="materials">Materials</h3>
<p>You can find additional lab materials and presentation content at the locations below:</p>
<ul>
<li>Presentation: </li>
<li>Source code for the code used in this guide: <a href="https://github.com/mikebranstein/GlobalAzureDay2017">https://github.com/mikebranstein/GlobalAzureDay2017</a></li>
<li>Source code for this guide (yes, it&#39;s all out there): <a href="https://mikebranstein.github.io/GlobalAzureDay2017-instructions/">https://github.com/mikebranstein/GlobalAzureDay2017-instructions</a></li>
</ul>

			</div>
			<hr>
			<div class="chapter">
				<h2 id="getting-project-from-github">Getting project from Github</h2>
<p>All the code you&#39;ll need for working through the bootcamp are stored on Github at <a href="https://github.com/mikebranstein/GlobalAzureDay2017">https://github.com/mikebranstein/GlobalAzureDay2017</a>.</p>
<h3 id="organization-of-the-repository">Organization of the Repository</h3>
<p>The repository at <a href="https://github.com/mikebranstein/GlobalAzureDay2017">https://github.com/mikebranstein/GlobalAzureDay2017</a> is organized into several <a href="https://github.com/mikebranstein/GlobalAzureDay2017/branches">branches</a>:</p>
<ul>
<li>start</li>
<li>chapter2</li>
<li>chapter5</li>
<li>chapter6</li>
<li>chapter7</li>
<li>chapter9</li>
</ul>
<p>Each branch corresponds with the chapters in this bootcamp guide. The guide starts with the code from the <code>start</code> branch, and progresses with each chapter. </p>
<blockquote>
<p><strong>NOTE</strong> You don&#39;t need to copy the code from each branch, only the <code>start</code> branch. If you&#39;re following along with the guide, you can start with the <code>start</code> branch. If you get stuck, or if you can&#39;t follow-along, you can grab a fresh set of code from a branch name matching the chapter you&#39;re on. For example, if you get stuck and can&#39;t get your code working at the end of chapter 5, you can jump to chapter 6 and grab the <code>chapter6</code> branch.</p>
</blockquote>
<h3 id="pre-requisites">Pre-requisites</h3>
<p>Before we go any further, be sure you have all the pre-requisites downloaded and installed. You&#39;ll need the following:</p>
<ul>
<li>Microsoft Windows PC</li>
<li><a href="https://www.visualstudio.com">Visual Studio</a> 2015 or later</li>
<li><a href="https://azure.microsoft.com">Azure Subscription</a> (trial is ok, and we&#39;ll sign you up in our first session)</li>
<li><a href="https://azure.microsoft.com/en-us/downloads/">Azure SDK for .NET</a> installed (be sure to get the right one for your version of Visual Studio)</li>
<li><a href="http://storageexplorer.com/">Storage Explorer</a> installed</li>
<li><a href="https://go.microsoft.com/fwlink/?LinkId=717179&amp;clcid=0x409">Storage Emulator</a> installed</li>
<li>The <a href="https://github.com/mikebranstein/GlobalAzureDay2017/tree/start">starter project</a> on Github</li>
</ul>
<h3 id="clone-project-from-start-branch">Clone project from start branch</h3>
<p>Let&#39;s get started by getting the <code>start</code> branch.</p>
<h4 class="exercise-start">
    <b>Exercise</b>: Getting the code
</h4>

<p>Clone or download the <code>start</code> branch from <a href="https://github.com/mikebranstein/GlobalAzureDay2017/tree/start">https://github.com/mikebranstein/GlobalAzureDay2017/tree/start</a>).</p>
<p>Use this <a href="https://github.com/mikebranstein/GlobalAzureDay2017/archive/start.zip">link</a> to download a zip file of the <code>start</code> branch.</p>
<p><img src="images/chapter1/downloaded-zip.png" alt="image"></p>
<blockquote>
<p>Don&#39;t open the zip file yet. You need to unblock it first!</p>
</blockquote>
<p>Right-click the zip file and go to the properties option. Check the <em>Unblock</em> option, press <em>Apply</em>, press <em>Ok</em>.</p>
<p><img src="images/chapter1/unblock.gif" alt="image"></p>
<p>Now it&#39;s safe to unzip the file to your harddrive. </p>
<div class="exercise-end"></div>

<h3 id="verify-the-site-works">Verify the site works</h3>
<h4 class="exercise-start">
    <b>Exercise</b>: Compiling the solution
</h4>

<p>Open the solution in Visual Studio by double-clicking the <code>Web.sln</code> file in to root of the extracted files:</p>
<p><img src="images/chapter1/solution-file.png" alt="image"></p>
<p>The opened solution should look like this:</p>
<p><img src="images/chapter1/opened-solution.png" alt="image"></p>
<p>Build and debug the solution. You shoudl see the MVC 5 template spin up in your browser.</p>
<p><img src="images/chapter1/site.png" alt="image"></p>
<div class="exercise-end"></div>

<p>That&#39;s it! You&#39;re up and running and ready to move on!</p>

			</div>
			<hr>
			<div class="chapter">
				<h2 id="updating-windows-identity">Updating Windows Identity</h2>
<h3 id="exploring-windows-identity">Exploring Windows Identity</h3>
<h3 id="replacing-it-with-azure-table-storage">Replacing it with Azure Table Storage</h3>
<h3 id="what-is-azure-table-storage-">What is Azure Table Storage?</h3>
<h3 id="remove-entity-framework">Remove Entity Framework</h3>
<ul>
<li>Microsoft.AspNet.Identity.EntityFramework</li>
<li>EntityFramework</li>
</ul>
<h3 id="add-elcamino-aspnet-identity-azuretable">Add ElCamino.AspNet.Identity.AzureTable</h3>
<p>ElCamino is a ASP.NET Identity package that allows Identity to use table storage instead of a SQL database.</p>
<ul>
<li>ElCamino.AspNet.Identity.AzureTable</li>
</ul>
<p>It&#39;ll install a bunch of other packages, but just let it. </p>
<h3 id="update-the-additional-nuget-packages-that-were-just-installed-with-elcamino">Update the additional NuGet packages that were just installed with ElCamino</h3>
<p>You may need to do that multiple times. </p>
<h3 id="identitymodel-cs">IdentityModel.cs</h3>
<ul>
<li>replace usings to strip out EF and support the ElCamino versions</li>
<li>instead of public class ApplicationDbContext : IdentityDbContext&lt;&gt;, you need to inherit ApplicationDbContext: IdentityCloudContext</li>
<li>change the whole class reference of ApplicationDbContext</li>
</ul>
<h3 id="identityconfig-cs">IdentityConfig.cs</h3>
<ul>
<li>replace usings</li>
<li>add the StartupAsync() function to the ApplicationUserManager class to tell identity to auto-create the azure tables</li>
</ul>
<h3 id="globalasax-cs">Globalasax.cs</h3>
<ul>
<li>call the azure table create process </li>
</ul>
<h3 id="web-config">web.config</h3>
<ul>
<li>remove EF references</li>
<li>add elcamino configuration to configSections</li>
</ul>
<h3 id="build-and-compile-your-app">build and compile your app</h3>

			</div>
			<hr>
			<div class="chapter">
				<h2 id="testing-your-app-locally-using-storage-emulator">Testing your app locally using storage emulator</h2>
<h3 id="install-azure-storage-emulator-and-explorer">Install azure storage emulator and explorer</h3>
<ul>
<li>URL: <a href="https://go.microsoft.com/fwlink/?linkid=717179&amp;clcid=0x409">https://go.microsoft.com/fwlink/?linkid=717179&amp;clcid=0x409</a></li>
<li>URL: <a href="http://storageexplorer.com/">http://storageexplorer.com/</a></li>
</ul>
<h3 id="start-azure-sotrage-explorer">Start azure sotrage explorer</h3>
<ul>
<li>from start menu</li>
<li>command line</li>
<li>start storage explorer</li>
<li>run the project</li>
<li>when the site loads, you should see in your (Local and Attached) the tables AspNetIndex, AspNetRoles, AspNetUsers</li>
</ul>
<h3 id="test-it-out">Test it out</h3>
<ul>
<li>register a new user</li>
<li>Look in the AspNetUsers table to the added user</li>
</ul>

			</div>
			<hr>
			<div class="chapter">
				<h2 id="connecting-the-app-to-azure">Connecting the app to Azure</h2>
<h3 id="resource-group">resource Group</h3>
<ul>
<li>create resource group</li>
</ul>
<h3 id="storage-account">Storage account</h3>
<ul>
<li><p>create storage account</p>
<ul>
<li>name (remember it)</li>
<li>deployment model: resource manager</li>
<li>Account kind: general purpose</li>
<li>Performance: standard</li>
<li>Replication: Locally-redundant storage (LRS)</li>
<li>Storage service encryption: Disabled</li>
<li>Resource group: Use existing (from the prrevious)</li>
<li>Location: East US</li>
</ul>
</li>
<li><p>Wait for it to deploy</p>
</li>
</ul>
<h3 id="connect-to-it-from-storage-explorer">Connect to it from storage explorer</h3>
<ul>
<li>add subscription azure storage explorer</li>
<li>select the subscription</li>
<li>find the sotrage account</li>
<li>right-cick, copy Primary key</li>
<li>Update connection string</li>
<li>Account name: what you entered above</li>
<li>Account key: what you copied from storage explorer</li>
</ul>
<h3 id="re-run-and-test-">Re-run and test!</h3>
<ul>
<li>register a new account, test out the site</li>
</ul>
<h3 id="now-you-have-a-cloud-based-central-authentication-database">now you have a cloud-based central authentication database</h3>
<ul>
<li>highly-scalable</li>
<li>can be encrypted</li>
<li>can use it across applications</li>
</ul>
<h3 id="web-app">web app</h3>
<ul>
<li>create web app in resource group</li>
<li>upload to azure from visual studio</li>
<li>test it!</li>
</ul>

			</div>
			<hr>
			<div class="chapter">
				<h2 id="adding-a-custom-field-to-aspnet-identity">Adding a custom field to AspNet Identity</h2>
<p>I want to add a biography. </p>
<h3 id="update-identitymodel-cs">Update IdentityModel.cs</h3>
<ul>
<li>add public string Biography { get; set; } to ApplicationUser class</li>
</ul>
<h3 id="update-identityconfig-cs">Update IdentityConfig.cs</h3>
<ul>
<li>Add async accessor method to ApplicationUserManager class GetBiographyAsync(string userId);</li>
</ul>
<h3 id="build-the-update-biography">Build the Update Biography</h3>
<ul>
<li>update the IndexViewModel to include the Biography property</li>
<li><p>update Index.cshtml, add HTML to display the update biography links</p>
</li>
<li><p>add class to ManageViewModels.cs</p>
</li>
<li>create UpdateBiography.cshtml</li>
<li>copy paste the HTML</li>
<li>add GET controller action</li>
<li>locate ManageMessageId enum in the hidden Helpers area, add the UpdateBiographySuccess value to the enum</li>
<li><p>add POST controller action</p>
</li>
<li><p>update the Index GET function to display the correct update message and to load in the Biography via the user manager</p>
</li>
</ul>
<h3 id="test-it-">test it!</h3>
<ul>
<li>works</li>
<li>note that the tables are automatically upgraded to account for the changes we&#39;ve made</li>
</ul>

			</div>
			<hr>
			<div class="chapter">
				<h2 id="adding-a-profile-picture-to-the-app">Adding a profile picture to the app</h2>
<p>We want to add a profile picture. It&#39;s similar to the biography, and we&#39;ll reuse some of the work we&#39;ve alreayd done to display it.</p>
<h3 id="update-identitymodel-cs">Update IdentityModel.cs</h3>
<ul>
<li>add profile picture url to ApplicationUser</li>
</ul>
<h3 id="update-identityconfig-cs">Update IdentityConfig.cs</h3>
<ul>
<li>Add async accessor method to ApplicationUserManager class GetProfilePicAsync(string userId);</li>
</ul>
<h3 id="add-profile-pic-to-to-the-web-app">Add Profile Pic to to the web app</h3>
<ul>
<li>update the IndexViewModel to include the Profile Picture property</li>
<li><p>update Index.cshtml, add HTML to display the update profile picture and a hiddenFor field links</p>
</li>
<li><p>ManageViewModels.cs, add System.Web to usings</p>
</li>
<li><p>update UpdateBiographyViewModel class in ManageViewModels.cs</p>
</li>
<li><p>update UpdateBiography.cshtml, adding profile picture div</p>
</li>
<li><p>update GET controller action for UpdateBiography</p>
</li>
<li>update POST controller action for UpdateBiography</li>
<li>add method UploadImageAsync</li>
<li><p>add usings to support UploadImageSync code</p>
</li>
<li><p>add app settings: StorageAccountName, StorageAccountKey, ProfilePicBlobContainer</p>
</li>
<li><p>replace values for storage account name, storage account key</p>
</li>
<li><p>update the Index GET function to display the correct update message and to load in the ProfilePicUrl via the user manager</p>
</li>
</ul>
<h3 id="test-">test!</h3>
<ul>
<li>run web site</li>
<li>check out storage explorer</li>
</ul>

			</div>
			<hr>
			<div class="chapter">
				<h2 id="introducing-a-staging-area-for-images">Introducing a staging area for images</h2>
<p>We really don&#39;t want to allow employees to upload ANYTHING into their profile picture....</p>
<h3 id="update-web-app-to-place-code-into-a-staging-area">update web app to place code into a staging area</h3>
<ul>
<li>update Index.cshtml verbiage for alt img tag</li>
<li>update manage controller code for UploadImageAsync</li>
<li>add web.config app setting for ProfilePicUploadBlobContainer</li>
</ul>
<h3 id="view-results">view results</h3>
<ul>
<li>run project</li>
<li>upload an image</li>
<li>look at storage explorer and see image in the uploaded directory</li>
</ul>

			</div>
			<hr>
			<div class="chapter">
				<h2 id="processing-images-with-azure-functions">Processing images with Azure Functions</h2>
<p>Introduction</p>
<h3 id="create-azure-funciton-use-content-from">Create Azure funciton - use content from</h3>
<p><a href="https://github.com/Microsoft/TechnicalCommunityContent/blob/master/Cloud%20Computing/Azure%20Functions/Session%202%20-%20Hands%20On/Azure%20Functions%20HOL%20(C%23).md">https://github.com/Microsoft/TechnicalCommunityContent/blob/master/Cloud%20Computing/Azure%20Functions/Session%202%20-%20Hands%20On/Azure%20Functions%20HOL%20(C%23).md</a></p>
<ul>
<li>use same storage account that we previously created</li>
<li>update project.json storage dependency</li>
</ul>

			</div>
			<hr>
			<div class="chapter">
				<h2 id="sending-results-back-to-your-browser">Sending results back to your browser</h2>
<p>Why not use SignalR? </p>
<h3 id="architecture">Architecture</h3>
<p>What are we building? </p>
<ol>
<li>The profile page establishes a signalr listener on load</li>
<li>When AZure function finishes, it posts to a Web API endpoint hosted in our website</li>
<li>The Web API enpoint pushes a SignalR message to it&#39;s lisnters, using a server broadcast</li>
<li>listener on the page determines if it&#39;s image is the once that was processed, then reloads the img source by appending a querystring to the image source URL</li>
</ol>
<h3 id="install-the-signalr-nuget-packages">Install the SignalR NuGet packages</h3>
<ul>
<li>Microsoft.AspNet.SignalR</li>
<li>Microsoft.AspNet.SignalR.Core</li>
<li>Microsoft.AspNet.SignalR.JS</li>
<li>Microsoft.AspNet.SignalR.SystemWeb</li>
</ul>
<h3 id="establish-listener-on-index-cshtml-page">establish listener on Index.cshtml page</h3>
<ul>
<li>add script to Index.cshtml page</li>
</ul>
<h3 id="create-a-singalr-hub">Create a singalR hub</h3>
<p>definition</p>
<ul>
<li>Add class ProfilePicHub.cs to the root of the project</li>
<li>Then need to create a class that is responsible for broadcasting a message. Create ProfilePicture</li>
</ul>
<h3 id="configure-signalr-to-start-with-the-app">Configure SignalR to start with the app</h3>
<ul>
<li>Startup.cs - add line app.MapSignalR(); </li>
</ul>
<h3 id="install-webapi-nuget-packages">Install WebAPI Nuget packages</h3>
<ul>
<li>Microsoft.AspNet.WebApi</li>
<li>Microsoft.AspNet.WebApi.Core</li>
<li>Microsoft.AspNet.WebApi.WebHost</li>
<li>Microsoft.AspNet.WebApi.Client</li>
</ul>
<h3 id="configure-web-api-in-solution">Configure Web Api in solution</h3>
<ul>
<li>create WebApiConfig.cs file in App_Start folder</li>
<li>update Global.asax.cs file - using System.Web.Http;</li>
<li>update Global.asax.cs file - add GlobalConfiguration.Configure(WebApiConfig.Register) before the route</li>
</ul>
<h3 id="add-a-profilepicturecontroller-class">Add a ProfilePictureController class</h3>
<ul>
<li>profilepicture controller class, add code</li>
</ul>
<h3 id="update-azure-function">update Azure Function</h3>
<ul>
<li>add more signal r code</li>
</ul>
<h3 id="test-it">test it</h3>
<ul>
<li>deploy your website to azure and watch the magic happen</li>
</ul>

			</div>
		</div>
	</div>
</div>

<script src="scripts/built.js"></script>

</body>
</html>